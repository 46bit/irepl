#!/usr/bin/env ruby

require 'socket'

who = ARGV[0]
exp = STDIN.read

sock = UNIXSocket.new '/tmp/irepl.sock'

sock.puts who
sock.puts exp.bytesize
sock.print exp

len = sock.gets.chomp.to_i
puts sock.read(len)
sock.close
